.. dropdown:: Distribution Statement

 | # # # This source code is protected under the license referenced at
 | # # # https://github.com/NRLMMD-GEOIPS.

Version 1.14.0a0 (2024-07-16)
*****************************

* Bug Fixes

  * Fix failing test data CLI unit tests
  * Correct typo causing product family xrdict_area_product_to_outlist failure
  * Fix push of doclinttest-stable image to ghcr.io
  * Fix duplicate logs, cartopy version, and expose unit test

* Documentation Updates

  * Update LICENSE and DISTRIBUTION to latest approved version, update all file headers
  * Add pinkrst and brassy to dependencies

* Enhancements

  * Added 'expose' command

Bug Fixes
=========

Correct typo causing product family xrdict_area_product_to_outlist failure
--------------------------------------------------------------------------

*From GEOIPS#666: 2024-07-16, Final Bug Fixes Prior to Workshop*

Product families that did not have pre-defined output lists and expected data
passed unmodified from the readers to the output formatters were failing due to
a missing else statement ensuring the list of final_products was set even when
the output file list was not pre-defined.  Add else statement to set final_products
to curr_products when output file list not defined.

This resolved an error with product family xrdict_area_product_to_outlist when
it was requested without sectoring, but it worked if sectoring was requested
(followed a different route through the code for each).

::

  modified: geoips/plugins/modules/procflows/single_source.py

Fix failing test data CLI unit tests
------------------------------------

*From GEOIPS#666: 2024-07-14, Final Bug Fixes Prior to Workshop*

``test_geoips_config_install.py`` and ``test_log_setup.py`` had 1 or more tests that
were failing, which caused the CI to fail as well. Fix these unit tests so
we can actually use the CI to address problems that are coming from new PRs. Below are
the files that required changes.

::

    modified: tests/unit_tests/commandline/test_log_setup.py
    modified: tests/unit_tests/commandline/cli_top_level_tester.py
    deleted: tests/unit_tests/commandline/test_geoips_config_install.py

Fix push of doclinttest-stable image to ghcr.io
-----------------------------------------------

*From GEOIPS#681: 2024-07-16, Fix push of doclinttest-stable image to ghcr.io*

Incorrect/old variables were being used in this step, but the issue wasn't
revealed until we pushed to main because the step didn't run except on main.
Added an additional step to also push doclinttest-latest in the same manner,
but from any branch to ensure that the doclinttest-stable step will succeed.

::

    modified: .github/workflows/doc-lint-test.yaml

Fix duplicate logs, cartopy version, and expose unit test
---------------------------------------------------------

*From GEOIPS#685: 2024-07-17, Fix unit test that will fail if any plugin packages with console scripts are installed*

There are a few lingering bugs that need fixed before the workshop starts in August.
These were relatively simple to fix so I merged three bug fixes into this PR.

Bug #1 managed to stay in GeoIPS for a while, and resulted in duplicate log statements
for every log level. This was caused by ``geoips.commandline.log_setup:setup_logging``
and would result in ``LOG X (num times setup_logging called)`` per a program's execution.
To fix this, I added two global variables in ``setup_logging``, once of which tests if
that function has already been called, the second being a ``log`` variable that will be
returned the first time, and every time after this function is called. With this update,
we need to make sure that the lowest log-level requested should be called FIRST.
Otherwise, it will be obfuscated by higher level log levels.

Bug #2 was a simple fix, and was just a version change for Cartopy in pyproject.toml.
There was a minor pixel difference in some tests outputs using version 0.22.0, so we
updated this to gt=0.23.0.

Bug #3 was a possible bug that was introduced by the expose command. There was a
hardcoded portion of a unit test for that command that could result in failed tests
if certain packages had console scripts. We've refactored this command to be dynamic,
and now should pass no matter what packages are provided.

::

    modified: geoips/commandline/commandline_interface.py
    modified: geoips/commandline/log_setup.py
    modified: pyproject.toml
    modified: tests/unit_tests/commandline/test_expose.py

Documentation Updates
=====================

Add pinkrst and brassy to dependencies
--------------------------------------

*From GEOIPS#675: 2024-07-16, Add brassy and pinkrst to geoips lint dependencies*

::

  modified: pyproject.toml

Update LICENSE and DISTRIBUTION to latest approved version, update all file headers
-----------------------------------------------------------------------------------

*From GEOIPS#666: 2024-07-14, Final Bug Fixes Prior to Workshop*

This file header should no longer have to change.

::

  modified: LICENSE
  modified: DISTRIBUTION
  modified: Every single file

Enhancements
============

Added 'expose' command
----------------------

*From GEOIPS#274: 2023-08-19, Add useage to setup.sh for command discovery*

The aforementioned issue requested that we add functionality to expose all commands
available in the GeoIPS environment. Rather than adding this functionality to setup.sh,
I've decided to add another function to geoips_utils.py which will expose all GeoIPS
commands in a tabular format. We expose available commands in a certain GeoIPS plugin
package to the terminal for easy perusal by the user. This will work for any new command
added in the future as well. This function adds one new dependency, ``tabulate``, though
``tabulate`` is added as a dependency to the CLI PRs anyways. We expect this might be
refactored into the CLI in a future PR.

To use this new function, reinstall GeoIPS via ``pip install -e .``, and run the command
``expose``.

This branch additionally includes a very small change made to two reader files and the
unit test for ``geoips validate`` as there were a couple of unit tests that could fail
due to relative imports used in a non-editable installed package.

::

    modified: pyproject.toml
    modified: geoips/errors.py
    modified: geoips/geoips_utils.py
    modified: geoips/plugins/modules/readers/seviri_hrit.py
    modified: geoips/plugins/modules/readers/windsat_remss_winds_netcdf.py
    modified: tests/unit_tests/commandline/test_geoips_validate.py
    added: tests/unit_tests/commandline/test_expose.py
