# If you do not wish to add the conda init information directly to
# your .bashrc, config_bash_geoips will source this geoips_conda_init_setup
# after $GEOIPS_DEPENDENCIES_DIR is set.

# These lines are pulled directly from the auto-generated .bashrc conda init.

if [[ "$GEOIPS_CONDA_ENV_NAME" == "" ]]; then
    GEOIPS_CONDA_ENV_NAME="geoips_conda"
fi

if [[ -z $GEOIPS_CONDA_INSTALL_DIR && -z $GEOIPS_DEPENDENCIES_DIR ]]; then
    GEOIPS_CONDA_INSTALL_DIR=$GEOIPS_PACKAGES_DIR/../geoips_dependencies/miniconda3
elif [[ -z $GEOIPS_CONDA_INSTALL_DIR ]]; then
    GEOIPS_CONDA_INSTALL_DIR=$GEOIPS_DEPENDENCIES_DIR/miniconda3
fi
echo "GEOIPS_CONDA_ENV_NAME: $GEOIPS_CONDA_ENV_NAME"
echo "GEOIPS_CONDA_INSTALL_DIR: $GEOIPS_CONDA_INSTALL_DIR"

# DO NOT set PATH in here. Ever.
if [[ -f $GEOIPS_CONDA_INSTALL_DIR/bin/conda ]]; then
    # >>> conda initialize >>>
    # !! Contents within this block are managed by 'conda init' !!
    __conda_setup=`$GEOIPS_CONDA_INSTALL_DIR/bin/conda 'shell.bash' 'hook'`
    if [ $? -eq 0 ]; then
        eval "$__conda_setup"
    else
        if [ -f "$GEOIPS_CONDA_INSTALL_DIR/etc/profile.d/conda.sh" ]; then
            . "$GEOIPS_CONDA_INSTALL_DIR/etc/profile.d/conda.sh"
        elif [ -f "$GEOIPS_CONDA_INSTALL_DIR/etc/profile.d/mamba.sh" ]; then
            . "$GEOIPS_CONDA_INSTALL_DIR/etc/profile.d/mamba.sh"
        fi
    fi
    unset __conda_setup
    # <<< conda initialize <<<
fi

whichconda=`which conda 2> /dev/null`
if [[ "$whichconda" != "" ]]; then
    if conda env list | grep -q --regex "^${GEOIPS_CONDA_ENV_NAME}"; then
        eval "$(conda shell.bash activate ${GEOIPS_CONDA_ENV_NAME})"
    fi
fi
